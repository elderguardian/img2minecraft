<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YUI</title>
    <script src="blockdata/blocks.js"></script>
</head>
<body>
    <form onsubmit="event.preventDefault(); onSearchFormSubmit()">
        <label for="searchedColorPicker">Pick a color to search:</label>
        <input type="color" id="searchedColorPicker">
        <input type="submit" value="Search">
    </form>

    <img id="outputImage" alt="found block" src="" width="200" height="200">

    <script>

        const colorPickerElement = document.getElementById('searchedColorPicker')
        const outputImageElement = document.getElementById('outputImage')

        const onSearchFormSubmit = () => {
            const searchedColorHex = colorPickerElement.value

            const searchedColorRgb = [
                parseInt(searchedColorHex.substring(1,3), 16),
                parseInt(searchedColorHex.substring(3,5), 16),
                parseInt(searchedColorHex.substring(5,7), 16)
            ]

            console.log(searchedColorRgb,  searchedColorHex)

            const blockFound = mostSimilarBlock(searchedColorRgb)
            const blockId = blockFound['id']

            outputImageElement.alt = blockId
            outputImageElement.src = `/blockdata/images/${blockId}`
        }

        const rgbColorSimilarity = (one, two) => {
            if (one.length !== 3 || two.length !== 3) {
                throw new Error('Invalid parameter format. Expected array with rgb values.')
            }

            // Formula for euclidean distance
            // d = sqrt( (R2-R1)^2 + (G2-G1)^2 + (B2-B1)^2 )

            let delta = Math.pow(two[0] - one[0], 2)
            delta += Math.pow(two[1] - one[1], 2)
            delta += Math.pow(two[2] - one[2], 2)
            delta = Math.sqrt(delta)

            return delta
        }

        const mostSimilarBlock = (searchedColor) => {
            let closestBlock = { id: null, similarity: null, }

            for (const block of blockdata) {
                const currentBlockId = block['id']
                const averageBlockColor = block['rgb']
                const similarity = rgbColorSimilarity(searchedColor, averageBlockColor)
                const isNewClosestBlock = closestBlock.id === null || closestBlock.similarity > similarity

                if (isNewClosestBlock) {
                    closestBlock.id = currentBlockId
                    closestBlock.similarity = similarity
                }
            }

            return closestBlock
        }

    </script>
</body>
</html>